FROM node:12

WORKDIR /migration
COPY ./package.json ./
RUN yarn global add sequelize sequelize-cli pg
RUN yarn install
COPY . .
RUN chmod +x /migration/wait-for-it.sh
# need to run make sure that es,postgresql, graphql are running before migrations
# also need to make sure the zombodb extension and the table are created (created in graphql), then seeded, then the index is created

# CMD ["sh","-c", "./wait-for-it.sh postgresql:5432 && ./wait-for-it.sh graphql:3001 && yarn typeoOrmSeed:run"]

CMD ["sh","-c", "./wait-for-it.sh postgresql:5432 && ./wait-for-it.sh graphql:3001 && yarn start:compose"]


